<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title></title>
	<meta name="description" content="">
	<meta name="viewport" content="width=device-width, initial-scale=1">


</head>
<body>
        <!--[if lt IE 7]>
            <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
            <![endif]-->

            <!-- <div id="container">Loading...</div> -->

            <section id="todoapp">
            	<header id="header">
            		<h1>Todos</h1>
            		<input type="text" id="new-todo" placeholder="What needs to be done?">
            	</header>
            	<section id="main">
            		<ul id="todo-list"></ul>
            	</section>
            </section>        

            <link rel="stylesheet" href="css/main.css">
            <script src="bower_components/underscore/underscore.js"></script>
            <script src="bower_components/jquery/dist/jquery.min.js"></script>
            <script src="bower_components/backbone/backbone.js"></script>
            <script src="js/localStorage.js"></script>

            <script type="text/template" id="item-template">
              <div class="view">
                <input class="toggle" id='<%- title %>' type="checkbox">
                <label for='<%- title %>'><%- title %></label>
              </div>
            </script>   

            <script>

        	// Sample A - Model
        	// ---------------------------------
			var app = {}; // create namespace for our app

			app.Todo = Backbone.Model.extend({
				defaults: {
					title: '',
					completed: false
				}
			});


        	// Sample B - Collection
        	// ---------------------------------
        	app.TodoList = Backbone.Collection.extend({
        		model: app.Todo,
        		localStorage: new Store("ahmads-todoList")
        	});

        	app.todoList = new app.TodoList();


            // Sample C - View
            // ---------------------------------
            app.TodoView = Backbone.View.extend({
                tagName: 'li',
                template: _.template($('#item-template').html()),
                render: function(){
                    this.$el.html(this.template(this.model.toJSON()));
                    return this; // enable chained calls
                }
            });


            // Sample D - Event
            // ---------------------------------
            // renders the full list of todo items calling TodoView for each one.
            app.AppView = Backbone.View.extend({
              el: '#todoapp',
              initialize: function () {
                this.input = this.$('#new-todo');
                // when new elements are added to the collection render then with addOne
                app.todoList.on('add', this.addOne, this);
                app.todoList.on('reset', this.addAll, this);
                app.todoList.fetch(); // Loads list from local storage
              },
              events: {
                'keypress #new-todo': 'createTodoOnEnter'
              },
              createTodoOnEnter: function(e){
                if ( e.which !== 13 || !this.input.val().trim() ) { // ENTER_KEY = 13
                  return;
                }
                app.todoList.create(this.newAttributes());
                this.input.val(''); // clean input box
              },
              addOne: function(todo){
                var view = new app.TodoView({model: todo});
                $('#todo-list').append(view.render().el);
              },
              addAll: function(){
                this.$('#todo-list').html(''); // clean the todo list
                app.todoList.each(this.addOne, this);
              },
              newAttributes: function(){
                return {
                  title: this.input.val().trim(),
                  completed: false
                }
              }
            });


            //--------------
            // Initializers
            //--------------   

            app.appView = new app.AppView();

        	</script>

        </body>
        </html>

